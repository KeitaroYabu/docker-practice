---
title: "２部: ストレージとは"
---

コンテナ内のファイルをホストマシンと共有するために、ストレージについて理解します。

# このページで初登場するコマンドとオプション
## ボリュームを作成する
```:コマンド
$ docker volume create [option]
```

### オプション
オプション | 意味 | 用途  
:-- | :-- | :--
`--name`   | ボリューム名を指定 | ID ではなく名前で扱えるようにする

## ボリュームを調べる
```:コマンド
$ docker volume inspect [option]
```

### オプション
このページで新たに使うオプションはなし

## コンテナを起動する
```:新コマンド
$ docker container run [option] <image> [command]
```

```:旧コマンド
$ docker run [option] <image> [command]
```

### オプション
オプション | 意味 | 用途  
:-- | :-- | :--
`-v, --volume`   | マウントする | 短く指定する
`--mount`   | マウントする   | 丁寧に指定する

# ストレージとは
todo で確認した通り、コンテナ内で作成・変更されたファイルはコンテナの終了とともに全てリセットされます。またホストマシンのファイルシステムとコンテナのファイルシステムは隔離されています。
このままではコンテナを一度終了するとコンテナ内にあったログやデータを次起動するコンテナに引き継げませんし、コンテナ内のプログラムをホストマシンで直接編集することもできません。

それらの課題を解決するために、ファイルをホストマシン常に保存するいくつかの方法のうち 2 つを説明します。

# ボリューム
## ボリュームとは
ボリュームはコンテナ内のファイルをホストマシン上で Docker が管理してくれる仕組みです。
「どこにどういう形式で保存されているかにあまり関心はなく、とにかくデータを永続化・共有したい」という場合に有用で、たとえば DB のデータの永続化やコンテナ間のファイル連携などに活用できます。

todo e

## ボリュームの作成とコンテナへのマウント
ボリュームを扱うには、まずボリュームを作成します。

次にコンテナ起動時に作成したボリュームをマウントします。

マウントするには `--volume` オプションと `--mount` オプションがありますが、細かな点を除いてできることにほぼ違いはありません。
この Book では両方のコマンドを掲載しますが、不慣れな場合は長いけどわかりやすくなる `--mount` の方で理解を深めることをおすすめします。



コンテナを跨いで `hello.txt` が存在することを確認できます。


## ボリュームの活用例

# バインドマウントとは
バインドマウントはホストマシンの任意のディレクトリをコンテナにマウントする仕組みです。
「ホストマシンとコンテナ双方がファイルの変更に関心がある」という場合に有用で、たとえばソースコードの共有などに活用できます。

## コンテナへのマウント
バインドマウントはホストマシンのファイルシステムをそのままマウントするので、事前にボリュームの作成のような作業は必要ありません。

バインドマウントも `--volume` オプションと `--mount` オプションで可能で、できることやメリットデメリットも同じです。

まずは `--volume` オプションを使ってコンテナを起動します。
1 つめをボリューム名ではなく絶対パスにすることでバインドマウントが行われるため、`pwd` を使ってカレントディレクトリをマウントします。

```:Host Machine
$ docker container run     \
  --name ubuntu            \
  --rm                     \
  --interactive            \
  --tty                    \
  --volume $(pwd):/my-bind \
  ubuntu:20.04             \
  bash

# cd /my-bind
```

コンテナ内でファイルを作成します。

```:Container
# echo 'Hello Bind.' > bind.txt
```

ホストマシン上でマウントしたディレクトリを確認すると、`bind.txt` があることを確認できます。

```:Host Machine
$ ls

bind.txt
```

ホストマシンで `bind.txt` に追記をします。

```:Host Machine
$ echo 'from Host Machine.' >> bind.txt
```

コンテナで確認できます。

```:Container
# cat bind.txt
Hello Bind.
from Host Machine.
```

コンテナを ( `bash` の終了によって ) 終了します。

```:Container
# exit
```

最後に `--mount` オプションを使ってコンテナ起動をする方法を確認します。
今回はバインドマウントをするので `type=bind` で、残りはボリュームマウントの時と同じく `src` と `dst` を使って指定します。

```:Host Machine
$ docker container run                      \
  --name ubuntu                             \
  --rm                                      \
  --interactive                             \
  --tty                                     \
  --mount type=bind,src=$(pwd),dst=/my-bind \
  ubuntu:20.04                              \
  bash

# cat /my-bind/bind.txt
Hello Bind.
from Host Machine.
```

## バインドマウントの活用例

