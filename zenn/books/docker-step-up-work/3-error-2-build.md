---
title: "🖥️ ｜ 🐳 ｜ ビルドのエラーを調べられるようになろう"
---

# 導入
## 目的・動機
Docker にまつわるエラーを調査できるようになりましょう。

このページは具体例を列挙して FAQ のように使うものではなく、イメージとコンテナとプロセスについての理解を深めることでエラーに自力で対処できる力をつけるのが目的です。

## このページで初登場するコマンド
特になし

# ビルドがエラーを出す理由
いくつか考えられますが、いくつか例を挙げると次のようなものがあります。

実際には いつ どこ なに を調べると事象がわかるという順番ですが、今回はクイズ形式で事象から いつ どこ なに を考えてみます。

## docker build がおかしい
次のような可能性があります。

- 単純に `-f` のパスが不一致
- Dockerfile に書いた `COPY` の相対パスと `docker build` のパスがずれている

:::details ワーク: いつ、どこ、なにを考えてから開く
- いつ: `docker build` 実行時
- どこ: ホストマシン
- なに: Docker Engine ( CLI? todo )

これらは `docker build` が即時失敗するので、容易に気付くことができます。
ホストマシンのターミナルのエラーをじっくり読めばすぐ解決するでしょう。
:::

## Dockerfile の RUN がおかしい
ここはある意味では無限に可能性がありますが、少しだけ例を挙げてみます。

- `RUN apt get -y vi` と書いている
  - ( 正: `RUN apt install -y vim` )

:::details ワーク: いつ、どこ、なにを考えてから開く
- いつ: `docker build` 実行時
- どこ: ホストマシン
- なに: Linux
  
`docker build` 実行時に `vi` のインストールに失敗するので、容易に気付くことができます。
ホストマシンのターミナルに Linux のエラーが出ているはずなので、そこが調査開始ポイントです。
:::

## Dockerfile の CMD がおかしい
もう一例だけ見てみます。

- PHP 開発サーバを起動するコマンドが `CMD php -S 0.0.0.0:8000` になっている
  - ( 正: `-t src` などのドキュメントルートの指定が必要 )

:::details ワーク: いつ、どこ、なにを考えてから開く
- いつ: ブラウザなどによるアクセス時
- どこ: コンテナ
- なに: PHP

`CMD` でコンテナ起動時の命令を指定していますが、それに問題があります。

ただし `CMD` はイメージにただ情報として含まれるだけなので、`docker build` は成功します。
また、この間違い方だと PHP 開発サーバは起動自体はするので `docker run` も成功します。
しかしブラウザなどでアクセスした際に、4xx とか 5xx 系のエラーになってしまうでしょう。

アクセス時エラーなのでコンテナ内の何らかの出力を探すことになりますが、調べるうちに PHP の起動の仕方が悪かったことがわかるはずです。
:::

# まとめ
