---
title: "🖥️ ｜ 🐧 ｜ コンテナプロセスのエラーを調べられるようになろう"
---

# 導入
## 目的・動機
Docker にまつわるエラーを調査できるようになりましょう。

このページは具体例を列挙して FAQ のように使うものではなく、イメージとコンテナとプロセスについての理解を深めることでエラーに自力で対処できる力をつけるのが目的です。

todo e ( build error / run error / exec error )

## このページで初登場するコマンド
特になし

# コンテナプロセスがエラーを出す理由
## e.g. Dockerfile の CMD がおかしい
もう一例だけ見てみます。

- PHP 開発サーバを起動するコマンドが `CMD php -S 0.0.0.0:8000` になっている
    - ( 正: `-t src` などのドキュメントルートの指定が必要 )

:::details ワーク: いつ、どこ、なにを考えてから開く
- いつ: ブラウザなどによるアクセス時
- どこ: コンテナ
- なに: PHP

`CMD` でコンテナ起動時の命令を指定していますが、それに問題があります。

ただし `CMD` はイメージにただ情報として含まれるだけなので、`docker build` は成功します。
また、この間違い方だと PHP 開発サーバは起動自体はするので `docker run` も成功します。
しかしブラウザなどでアクセスした際に、4xx とか 5xx 系のエラーになってしまうでしょう。

アクセス時エラーなのでコンテナ内の何らかの出力を探すことになりますが、調べるうちに PHP の起動の仕方が悪かったことがわかるはずです。

このように いつ が `docker build` ではなく なに も Docker ではない場合というのが珍しくありません。
いつ どこ なに を把握することが大切だと感じてもらえたでしょうか。
:::

## e.g. MySQL データベースに繋がらない
たとえば MySQL データベースに繋がらない場合はどうしたら良いでしょうか。

:::details ワーク: いつ、どこ、なにを考えてから開く
- いつ: アクセス時
- どこ: ホストマシンか自コンテナか他のコンテナ、つまりアクセス元次第 / MySQL コンテナ
- なに: MySQL / Docker

MySQL データベースに繋がらない理由は複数考えられます。

単純に認証情報が間違っている場合は、`my.cnf` によって出力するようにした `error.log` に出力があるでしょう。

```
# tail -n 1 /var/log/mysql/error.log
2022-01-30T05:41:09.131003Z 3 [Note] Access denied for user 'hoge'@'localhost' (using password: NO)
```

この場合は MySQL の設定を見直して正しいアクセスをすれば解消するはずです。

`error.log` に出力がなければ、ネットワーク的に MySQL データベースまで到達していない可能性があります。
その場合はクライアント側のプロセスのログを調べる必要があります。たとえば PHP のログや Rails のログなどのことです。

todo

その場合は Docker コンテナのネットワークなどを確認する必要があるでしょう。
:::

# アプローチ
## コンテナ内のログを見る
`docker run` の出力ではなく MySQL データベースなどの起動して動かしているプロセスのログを確認しましょう。

そのためには `docker exec` で接続することと、Dockerfile の `COPY` などで `error.log` などをちゃんと出力するようにしておくことが大切です。
